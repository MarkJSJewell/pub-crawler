<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pub Crawl Planner</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@geoapify/geocoder-autocomplete@3.0.1/styles/minimal.css">
    <style>
        /* Existing Styles... */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Google Sans', 'Roboto', Arial, sans-serif; background: #fff; color: #202124; padding-top: 80px; }
        
        /* [MODIFIED] Force White Background on Cards */
        .pub-card {
            background: #ffffff !important;
            border-bottom: 1px solid #e8eaed;
            padding: 16px 20px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .pub-card:hover { background: #f8f9fa !important; }

        /* Remove category background colors, keep left border only */
        .pub-card.priority, .pub-card.sports, .pub-card.outdoor, 
        .pub-card.afternoontea, .pub-card.happyhour, .pub-card.dogfriendly, 
        .pub-card.winebar, .pub-card.brewery {
            background: #ffffff !important;
        }

        /* Border Branding remains for context */
        .pub-card.priority { border-left: 4px solid #fbbc04; }
        .pub-card.sports { border-left: 4px solid #34a853; }
        .pub-card.outdoor { border-left: 4px solid #1a73e8; }
        .pub-card.afternoontea { border-left: 4px solid #ea4335; }
        .pub-card.happyhour { border-left: 4px solid #fbbc04; }
        .pub-card.dogfriendly { border-left: 4px solid #9334e6; }
        .pub-card.winebar { border-left: 4px solid #c41e3a; }
        .pub-card.brewery { border-left: 4px solid #ff6f00; }

        /* [NEW] Custom Autocomplete Styling for Geoapify */
        #autocomplete-container { position: relative; width: 100%; }
        .geoapify-autocomplete-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="search-container">
        <div class="search-form">
            <form id="search-form">
                <div class="form-group">
                    <label>Location</label>
                    <div id="autocomplete-container"></div>
                </div>
                
                <button type="submit" class="search-btn">Search</button>
            </form>
        </div>

        <div class="results-layout" id="results-layout">
            <div class="results-sidebar">
                <div class="route-summary" id="route-summary"></div>
                <div class="pub-list" id="pub-list"></div>
            </div>
            <div class="results-map"><div id="map"></div></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@geoapify/geocoder-autocomplete@3.0.1/dist/index.min.js"></script>
    <script>
        // Updated search function with caching
        async function searchPubs(location, numPubs, historicFilter, maxDistance, minRating, openNow, startingRadius) {
            showLoading();
            window.currentFilterType = historicFilter;

            try {
                // Generate a unique cache key based on search parameters
                const cacheKey = `pubs_${btoa(location + historicFilter + maxDistance + minRating)}`;
                const cached = localStorage.getItem(cacheKey);
                
                let pubs;
                if (cached) {
                    const parsed = JSON.parse(cached);
                    // Expire cache after 24 hours
                    if (Date.now() - parsed.timestamp < 86400000) {
                        console.log('Loading from LocalStorage cache...');
                        pubs = parsed.data;
                    }
                }

                if (!pubs) {
                    const center = await geocodeLocation(location);
                    pubs = await findPubs(center, 1000, historicFilter);
                    // Store results in cache
                    localStorage.setItem(cacheKey, JSON.stringify({
                        data: pubs,
                        timestamp: Date.now()
                    }));
                }

                // ... Remaining logic for optimizeRoute and displayResults ...
            } catch (error) {
                showError(error.message);
            }
        }
    </script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="auth.js"></script>
</body>
</html>